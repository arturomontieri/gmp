#!/bin/bash

prjfolder=$(dirname $0)/../
source ${prjfolder}/bin/gmp-env
myself=$(basename $0)
mlog=${prjfolder}/$logfolder/$myself.log
mpid=${prjfolder}/$pidfolder/$myself.pid

app="dbcron"
tmp=${app}_fh
#With the following statement fh will get the value decalred in gmp-env file
#for the variable $tmp, i.e. libqueue_fh
fh=${!tmp}

eval "exec $fh>$mpid"
eval "flock -x -w 1 -e $fh || exit 1" 

echo `date` " Starting  ${prjfolder}/bin/${app} " >> $mlog
alog=${prjfolder}/log/${app}.log
${prjfolder}/bin/${app} 1>>$alog 2>>$alog

#as dbcron should run each hour, added a sleep for not retriggering dbcron each 5 minutes
echo `date` " Sleeping for 50 minutes " >> $mlog
sleep 3000

echo `date` " Completed " >> $mlog

